<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EventOnline</title>

  <!-- Fonts & CSS -->
  <link rel="stylesheet"
        th:href="@{https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,0}"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet"
        th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css}"
        crossorigin="anonymous"/>
  <link rel="stylesheet" th:href="@{/css/style.css}"/>
  <link rel="stylesheet" th:href="@{/css/event.css}"/>
</head>
<body>
<div th:replace="~{layout :: header}"></div>

<main>
  <div class="container py-4">

    <!-- Search bar -->
    <form class="mb-4 search-form-unique"
          action="/customer/main-event"
          method="get">
      <div class="input-group-unique">
        <input type="text"
               name="keyword"
               class="form-control-unique"
               th:placeholder="#{home.search.placeholder}"
               aria-label="#{home.search.placeholder}"/>
        <button class="btn-search-unique" type="button">
          <span class="material-symbols-rounded">search</span>
        </button>
      </div>
    </form>

    <!-- Section title -->
    <h2 class="mb-4 text-center" style="color: black"
        th:text="#{home.list.title}">List of Events</h2>

    <!-- Events list -->
    <div id="event-container" class="row g-4">
      <div class="col-md-4"
           th:each="ev : ${eventForms}"
           th:attr="data-id=${ev.event.id}"
           th:with="isSoldOut = ${ev.remainTicket[0] <= 0},
                        isPastEvent = ${#temporals.createNow().isAfter(ev.event.startTime)},
                        isDisabled = ${isSoldOut or isPastEvent}">
        <div class="card event-card shadow-sm h-100">
          <img th:src="@{${ev.event.thumbnailUrl}}"
               class="card-img-top"
               th:alt="${ev.event.name}"/>
          <div class="card-body d-flex flex-column">
            <h5 class="card-title" th:text="${ev.event.name}">Event Title</h5>
            <p class="card-text flex-grow-1"
               th:text="${ev.event.description}">Event description</p>
            <p class="mb-1">
              <strong th:text="#{home.event.date}">Date Time:</strong>
              <span th:text="${#temporals.format(ev.event.startTime, 'dd/MM/yyyy hh:mm a')}"></span>
            </p>
            <p class="mb-1">
              <strong th:text="#{home.event.location}">Location:</strong>
              <span th:text="${ev.event.location.city}">City Hall</span>
            </p>
            <p class="mb-0">
              <strong th:text="#{home.event.ticketsLeft}">Tickets left:</strong>
              <span th:text="${ev.remainTicket[0]}">50</span>
            </p>

            <div class="d-flex gap-2 align-items-center justify-content-center">
              <a th:href="@{/user/event-details/{id}(id=${ev.event.id})}"
                 class="btn btn-primary mt-auto"
                 th:text="#{home.event.details}">Details</a>
                  <a
                    th:href="@{/user/buy-ticket/{id}(id=${ev.event.id})}"
                    class="btn btn-success mt-auto"
                    th:classappend="${isDisabled ? 'disabled' : ''}"
                    th:styleappend="${isDisabled ? 'pointer-events: none;' : ''}"
                    th:text="${isSoldOut} ? #{home.event.soldOut} : ( ${isPastEvent} ? #{home.event.past} : #{home.event.buy} )"
                    >Buy Ticket</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <nav class="mt-4">
          <ul class="pagination justify-content-center" id="pagination"></ul>
        </nav>
      </div>
    </main>
    <div th:replace="~{layout :: footer}"></div>
    <!-- JS -->
    <script th:src="@{/js/script.js}" defer></script>
    <script th:src="@{/js/event.js}" defer></script>

    <!-- Bootstrap JS Bundle (gá»“m Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script th:src="@{/js/main-events.js(v=${#dates.createNow().time})}"></script>
  </body>
</html>
